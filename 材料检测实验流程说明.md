# 材料检测实验系统页面

## 功能概述

本页面实现了材料检测实验的完整流程，采用**组件化设计**，主要包含两个核心功能：样品列表管理和实验检测流程。系统只允许已缩分的样品进行实验检测，确保检测流程的规范性。

## 系统架构

### 组件结构

```
detection.vue (主容器)
├── detection_1.vue (样品列表组件)
└── detection_2.vue (实验检测组件)
```

### 页面切换逻辑

- **默认显示**：样品列表页面（detection_1）
- **点击"开始实验"**：切换到实验检测页面（detection_2）
- **点击"返回样品列表"**：返回样品列表页面

## 组件详解

### 1. detection_1.vue - 样品列表组件

**功能说明**：
- 展示待检样品列表
- 支持搜索样品编号或名称
- 显示样品缩分状态
- 只允许已缩分样品开始实验

**界面元素**：
- 页面标题：试样列表（待检区）
- 搜索框：快速筛选样品
- 样品数据表格：
  - 样品编号
  - 样品名称
  - 状态标签（已缩分/未缩分）
  - 操作按钮（开始实验/不可操作）

**操作规则**：
- ✅ **已缩分样品**：显示蓝色"开始实验"按钮，可点击
- ❌ **未缩分样品**：显示灰色"不可操作"按钮，禁用状态

**样品数据**（示例）：
- SY20250401 - 机制砂（已缩分）✓
- SY20250402 - 天然砂（已缩分）✓
- SY20250403 - 碎石（未缩分）✗
- SY20250404 - 细砂（未缩分）✗
- SY20250405 - 粗砂（已缩分）✓
- SY20250406 - 特细砂（未缩分）✗
- SY20250407 - 混合砂（已缩分）✓
- SY20250408 - 石灰岩碎石（未缩分）✗

### 2. detection_2.vue - 实验检测组件

**功能说明**：
- 展示当前检测样品信息
- 5个独立的检测实验流程
- 实时显示实验进度和设备状态
- 支持单个实验的开始/暂停操作
- 所有实验完成后可上传分析结果

**界面元素**：
- 页面标题：试验检测
- 样品信息提示框
- 5个实验卡片（每个包含）：
  - 实验名称和图标
  - 实验进度条
  - 时间轴展示步骤
  - 设备名称（悬停显示状态）
  - 操作按钮
  - 实验结果显示

**实验列表**：

1. **筛分**（蓝色）
   - 步骤：称重 → 烘干 → 筛分 → 称取筛余质量
   - 设备：电子天平、烘箱、标准筛
   - 说明：样品经初步处理后进行筛分；各粒径分级记录质量

2. **含泥量**（红色）
   - 步骤：称重 → 烘干 → 水洗 → 烘干 → 称重
   - 设备：电子天平、烘箱、水洗槽
   - 说明：通过水洗去除细颗粒泥质物

3. **泥块含量**（绿色）
   - 步骤：称重 → 烘干 → 筛分 → 水洗 → 烘干 → 称重
   - 设备：电子天平、烘箱、标准筛、水洗槽
   - 说明：测定大于0.075mm的泥块含量

4. **针片状**（深蓝色）
   - 步骤：分选装置识别 → 分选装置识别 → 称重（分类）
   - 设备：工业相机、分选装置、电子天平
   - 说明：采用视觉识别技术区分针片状颗粒

5. **压碎值**（棕色）
   - 步骤：剔除针片状 → 水洗 → 烘干 → 标定加载 → 筛分 → 称重
   - 设备：分选装置、水洗槽、烘箱、压力机、标准筛、电子天平
   - 说明：选取特定粒级颗粒进行压碎试验

**底部操作栏**：
- 左侧："返回样品列表"按钮
- 右侧：
  - "检测结果上传分析"按钮（所有实验完成后启用）
  - "重置实验"按钮

## 使用流程

### 完整操作步骤

1. **进入系统**
   - 访问路径：`/components/detection`
   - 默认显示样品列表页面

2. **选择样品**
   - 浏览样品列表或使用搜索功能
   - 查看样品缩分状态
   - 点击已缩分样品的"开始实验"按钮

3. **执行实验**
   - 系统自动切换到实验检测页面
   - 查看当前检测样品信息
   - 逐个点击实验卡片的"开始实验"按钮
   - 观察实验进度和设备状态
   - 等待实验自动完成（每个步骤2-4秒）

4. **上传结果**
   - 所有实验完成后
   - 点击"检测结果上传分析"按钮
   - 系统自动收集实验数据并上传
   - 显示成功提示

5. **继续操作**
   - 点击"返回样品列表"选择其他样品
   - 或点击"重置实验"重新检测当前样品

## 设备状态说明

系统实时监控设备使用情况，鼠标悬停在设备名称上可查看：

- **空闲**：设备当前未被使用，可以使用
- **正在使用中**：设备正在执行当前步骤
- **已预约**：设备已被其他实验预约，等待使用

## 上传数据格式

点击"检测结果上传分析"时，系统自动生成以下JSON格式数据：

```json
{
  "sample": {
    "code": "SY20250401",
    "name": "机制砂"
  },
  "experiments": {
    "experiment1": {
      "title": "筛分",
      "result": "85.67%",
      "status": "completed"
    },
    "experiment2": {
      "title": "含泥量",
      "result": "3.24%",
      "status": "completed"
    },
    "experiment3": {
      "title": "泥块含量",
      "result": "1.85%",
      "status": "completed"
    },
    "experiment4": {
      "title": "针片状",
      "result": "12.45%",
      "status": "completed"
    },
    "experiment5": {
      "title": "压碎值",
      "result": "7.89%",
      "status": "completed"
    }
  },
  "timestamp": "2025-01-15T08:30:45.123Z"
}
```

## 关键特性

### 1. 权限控制
- ✅ 已缩分样品：可以开始实验
- ❌ 未缩分样品：不可操作，按钮禁用

### 2. 组件化设计
- 样品列表和实验检测完全独立
- 组件间通过事件通信
- 便于维护和扩展

### 3. 状态管理
- 实时设备状态监控
- 实验进度跟踪
- 自动状态更新

### 4. 用户友好
- 清晰的视觉反馈
- 直观的操作流程
- 响应式布局设计
- 友好的提示信息

### 5. 数据完整性
- 自动生成时间戳
- 完整的样品和实验信息
- 结构化的JSON数据

## 技术实现

### 技术栈
- **前端框架**：Vue 3 + TypeScript
- **UI组件库**：Vuetify 3
- **状态管理**：Vue 3 Composition API
- **组件通信**：Props + Emits

### 组件通信

**detection_1 → detection (父组件)**
```typescript
emit('start-detection', sample)
```

**detection_2 → detection (父组件)**
```typescript
emit('go-back')
emit('upload-results', data)
```

### 文件结构
```
src/views/componets/
├── detection.vue           # 主容器组件
└── components/
    ├── detection_1.vue     # 样品列表组件
    └── detection_2.vue     # 实验检测组件
```

## 扩展建议

未来可以考虑以下扩展功能：

1. **后端集成**
   - 连接实际的样品管理系统
   - 实现真实的数据上传API
   - 支持结果查询和历史记录

2. **缩分功能**
   - 添加样品缩分操作界面
   - 支持自动缩分和手动缩分
   - 实时更新样品状态

3. **权限管理**
   - 不同用户角色的访问控制
   - 操作日志记录
   - 审批流程

4. **报告生成**
   - 自动生成PDF检测报告
   - 支持报告模板定制
   - 报告导出和打印

5. **实时监控**
   - 接入真实设备状态数据
   - 设备故障预警
   - 设备使用统计

6. **批量处理**
   - 支持多个样品批量检测
   - 队列管理
   - 并行实验优化

## 常见问题

### Q: 为什么有些样品不能开始实验？
A: 系统要求样品必须先完成缩分操作才能进行实验检测。未缩分的样品会显示"不可操作"状态。

### Q: 如何查看设备状态？
A: 将鼠标悬停在实验步骤中的设备名称上，会显示该设备当前的占用状态。

### Q: 实验可以暂停吗？
A: 可以。在实验运行过程中，点击"暂停"按钮即可暂停当前实验。

### Q: 上传结果后数据去哪了？
A: 目前系统在控制台输出上传数据。实际应用中需要对接后端API，将数据保存到数据库或分析系统。

### Q: 可以重复检测同一个样品吗？
A: 可以。点击"重置实验"按钮即可清空当前所有实验状态，重新开始检测。

## 版本信息

- **版本**：2.0.0
- **更新日期**：2025-01-15
- **主要变更**：
  - 移除步骤导航和流程控制
  - 组件化重构
  - 添加权限控制
  - 优化操作流程
